apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: argocd

resources:
  - ../prometheus-app.yaml
  - ../loki-app.yaml
  - ../promtail-app.yaml
  - ../grafana-app.yaml

commonLabels:
  environment: prod
  managed-by: argocd

# Patches for production environment
patches:
  # Prometheus - use prod values
  - target:
      kind: Application
      name: prometheus
    patch: |-
      - op: replace
        path: /spec/source/helm/valueFiles
        value:
          - values.yaml
      - op: add
        path: /spec/syncPolicy/automated/prune
        value: false
  
  # Loki - use prod values
  - target:
      kind: Application
      name: loki
    patch: |-
      - op: replace
        path: /spec/source/helm/valueFiles
        value:
          - values.yaml
      - op: add
        path: /spec/syncPolicy/automated/prune
        value: false
  
  # Grafana - use prod values
  - target:
      kind: Application
      name: grafana
    patch: |-
      - op: replace
        path: /spec/source/helm/valueFiles
        value:
          - values.yaml
      - op: add
        path: /spec/syncPolicy/automated/prune
        value: false

